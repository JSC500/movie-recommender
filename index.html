<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <title>Filmvorschlag</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
</head>
<body style="width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; flex-direction: column; background: radial-gradient(circle, hsla(0, 0%, 0%, 1) 0%, hsla(211, 100%, 19%, 1) 100%); overflow: hidden;">
    <div id="recommendation" style="display: none; text-align: center; color: white; font-family: sans-serif;">
        <img id="poster" style="max-width: 500px; max-height: 500px; margin-bottom: 16px;"/>
        <h1 id="title" style="margin: 0;">Titel</h1>
        <h2 id="year" style="color: rgb(66, 153, 225); font-weight: lighter; margin: 0;">Jahr</h2>
        <h3 id="genre" style="font-weight: normal; margin: 0;">Genre</h3>
    </div>
    <button
        style="background: rgb(66, 153, 225); border-radius: 3.5px; border: 0; padding: 7px 14px; color: white; font-weight: bold; border-bottom: 4px solid rgb(43, 108, 176); margin-top: 20px;"
        onclick="recommendMovie()"
    >
        Schlag mir einen Film vor!
    </button>
</body>

<script>
    const options = {
        method: 'GET',
        headers: {
            accept: 'application/json',
            Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI2YWQ2NjUyMzkxYWIyOWZjN2EwODUyNTBlMGQxNGEzNyIsInN1YiI6IjY1YWY4MDQ4ZDEwMGI2MDBhZGE2YWU1MiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.8rqfmgrNrQoaM5tTUjzOro7pUlbe1ukYP7cfA0_DtB0'
        }
    };

    let genres = [];

    const getGenres = async () => {
        const genresJSON = await fetch('https://api.themoviedb.org/3/genre/movie/list?language=de', options);
        genres = (await genresJSON.json()).genres;
    }

    getGenres()

    const getRandomMovie = async () => {
        const response = await fetch('https://api.themoviedb.org/3/discover/movie?include_adult=false&include_video=false&language=de-DE&page=' + getRandomNumber(500), options);
        const movies = await response.json();
        return movies.results[getRandomNumber(movies.results.length)];
    }

    const getRandomNumber = (max) => {
        return Math.floor(Math.random() * (max));
    }

    const recommendMovie = async () => {
        const randomMovie = await getRandomMovie()
        document.getElementById('title').innerHTML = randomMovie.title;
        document.getElementById('year').innerHTML = randomMovie.release_date.substring(0, 4);
        console.log(genres);
        document.getElementById('genre').innerHTML = randomMovie.genre_ids.map(genreID => genres.find(genre => genre.id === genreID).name).join(', ');
        document.getElementById('poster').src = 'https://image.tmdb.org/t/p/w500/' + randomMovie.poster_path;
        document.getElementById('recommendation').style.display = 'block';
    }
</script>
</html>